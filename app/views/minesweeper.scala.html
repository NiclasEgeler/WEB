@(controller: de.htwg.se.minesweeper.controller.Controller)
@import play.api.mvc.Session

@getCellContent(cell: de.htwg.se.minesweeper.model.cell.ICell): String= @{
    if (cell.isFlagged) {
        return "F"
    }
    if (cell.isHidden) {
        return "?"
    }
    if (cell.isMine)
        return "#"
    return if (cell.getValue > 0) then cell.getValue.toString() else " "
}

@getCellClass(cell: de.htwg.se.minesweeper.model.cell.ICell): String= @{
    if (cell.isFlagged) {
        return "flagged"
    }
    if(cell.isMine && !cell.isHidden)
        return "cell-opened cell-mine"
    if(cell.isHidden)
        return ""
    
    "cell-opened " + (if (cell.getValue > 0) then ("cell-value-"+cell.getValue.toString()) else " ")
}

@showGameOver(cell: de.htwg.se.minesweeper.model.cell.ICell): Boolean= @{
    cell.isMine && !cell.isHidden
}

@main("Minesweeper") {
    <h1>Minesweeper</h1>
    <div id="game-container">
        <div id="game-board">
            @for(row <- 0 until controller.getGrid.getHeight){
                <div class="game-row">
                    @for(column <- 0 until controller.getGrid.getWidth){
                        <a href="@routes.HomeController.place(row, column)">
                            <div class="cell @getCellClass(controller.getGrid.getCell(row, column))">&ensp;@getCellContent(controller.getGrid.getCell(row, column))&ensp;</div>
                        </a>
                    }
                </div>
            }
        </div>
    </div>
    <div class="buttons">
        <form action="@routes.HomeController.undo()">
            <button type="submit" class="btn btn-primary">Undo</button>
        </form>
        <form action="@routes.HomeController.redo()">
            <button type="submit" class="btn btn-primary">Redo</button>
        </form>
    </div>

    @for(row <- 0 until controller.getGrid.getHeight; column <- 0 until controller.getGrid.getWidth){
        @if(showGameOver(controller.getGrid.getCell(row, column))) {
            <div class="alert alert-danger alert-dismissible fade show mt-3 text-center" role="alert">
                You just hit a mine and the game is over. If you want to continue, you can press the undo button.
                <button type="button" class="close" data-dismiss="alert" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
        }
    }
}